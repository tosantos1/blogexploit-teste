import Head from 'next/head';
import { useEffect, useState } from 'react';

import Link from 'next/link'

import styles from './styles.module.scss'


import * as I from '../../types/interfaceindex'

export default function Article() {
  const [items, setItems] = useState<I.ResponseMedium[]>([])

  const token = process.env.NEXT_MEDIUM

  useEffect(() => {
    const fetchData = async () => {
      const result = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fmedium.com%2Ffeed%2Flegiti&api_key=${token}`)
        .then((response) => response.json())
        .then((data) => setItems(data.items))
    }
    fetchData()
  }, [])

  return (
    <>
      <Head>
        <title> Blog | Exploit </title>
      </Head>
      <main>
        <section className={styles.contentContainer}>
          {items.map((item) => (
            <div className={styles.card} key={item.guid}>
              <div className={styles.cardItem1} >
                <h1>{item.title}</h1>
                <div className={styles.authorDate}>
                  <p><img src="/image/user.png" alt="" />{item.author}</p>
                  <p><img src="/image/calendar.png" alt="" />{new Date(item.pubDate).toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}</p>
                </div>
                <div className={styles.CategoriesSpan}>
                  <span>{item.categories.slice(1, 2)}</span>
                  <span>{item.categories.slice(2, 3)}</span>
                  <span>{item.categories.slice(3)}</span>
                </div>
                <Link
                  href={`/post/${item.guid.split('/')[4]}`}>
                  <a>Abrir artigo</a>
                </Link>
              </div>
              <div className={styles.cardItem2}>
                <img src={`${item.thumbnail}`} alt="" />
              </div>
            </div>
          ))}
        </section>
      </main >
    </>
  )
}
