import Head from 'next/head';
import { useEffect, useState } from 'react';

import styles from './styles.module.scss'

import Modal from 'react-modal'

import * as I from '../../types/interfaceindex'
import Header from '../Header';


export default function Article() {

  const [isArticleModalOpen, setIsArticleModalOpen] = useState(false);
  const [selectArticle, setSelectArticle] = useState<I.ResponseSelectProps>()


  function handleOpenArticleModal(article) {
    setIsArticleModalOpen(true);
    setSelectArticle(article)
  }
  function handleCloseArticleModal() {
    setIsArticleModalOpen(false);
  }

  const [items, setItems] = useState<I.ResponseMedium[]>([])
  const [itemsPerPage, setIntensPerPage] = useState(3)
  const [currentPage, setCurrentPage] = useState(0)

  const pages = Math.ceil(items.length / itemsPerPage)
  const startIndex = currentPage * itemsPerPage
  const endIndex = startIndex + itemsPerPage
  const currentItems = items.slice(startIndex, endIndex)


  const token = process.env.NEXT_MEDIUM

  useEffect(() => {
    const fetchData = async () => {
      const result = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fmedium.com%2Ffeed%2Flegiti&api_key=${token}`)
        .then((response) => response.json())
        .then((data) => setItems(data.items.splice(1)))
    }
    fetchData()
  }, [])

  useEffect(() => {
    setCurrentPage(0)
  }, [itemsPerPage])



  return (
    <>
      <Head>
        <title> Blog | Exploit </title>
      </Head>
      <main>
        <section className={styles.contentContainer}>

          <h1>Artigos</h1>
          {currentItems.map((item) => (
            <div className={styles.card} key={item.guid}>
              <div className={styles.cardItem1} >
                <h1>{item.title}</h1>
                <p>Escrito por: {item.author}</p>
                <p>{new Date(item.pubDate).toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}</p>
                <div className={styles.CategoriesSpan}>
                  <span>{item.categories.slice(1, 2)}</span>
                  <span>{item.categories.slice(2, 3)}</span>
                  <span>{item.categories.slice(3)}</span>
                </div>
                <button onClick={() => handleOpenArticleModal(item)}>Abrir artigo</button>
              </div>
              <div className={styles.cardItem2}>
                <img src={`${item.thumbnail}`} alt="" />
              </div>
            </div>
          ))}
        </section>
      </main >

      <Modal
        isOpen={isArticleModalOpen}
        onRequestClose={handleCloseArticleModal}
        overlayClassName="react-modal-overlay"
        className="react-modal-content"
      >
        <Header />
        <div className={styles.cardModal} >
          <h1>{selectArticle?.title}</h1>
          <div className={styles.cardModalContent} >
            <div className={styles.cardModalItem} dangerouslySetInnerHTML={{ __html: selectArticle?.content }}>
            </div>
          </div>
        </div>
      </Modal>
    </>
  )
}
